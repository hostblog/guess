var polyxgoApp=angular.module('polyxgo_offers_coupons',[]);var page=-1;polyxgoApp.controller('polyxgo_coupons_data_controller',function($scope,$http,$timeout){var modalXXX=jQuery('#PolyXGOModalMessage');$coupons=[];$scope.maxrest=maxPerRest;$scope.isdone=!1;$scope.messrest='';$scope.search='';$scope.isprocessing=!1;$scope.PolyXGOCouponsDataRest=function(){if($scope.isdone==!1&&$scope.messrest===''){page++;var urlBranch=sync_coupons_brand.replace('{{PAGE}}',page);$scope.messrest='đang tải... ';$http({method:'GET',url:urlBranch,headers:{"Content-Type":'application/json',}}).then(function successCallback(response){var data=response.data;if((data!=null||data!='undefined')&&data.length!=0){if(data.status=="401"){if(data.message==='Unauthorized'||data.status==='401'){modalXXX.find('#PolyXGOModalMessageTitle').html('Serial hết hạn! ('+data.status+')');modalXXX.find('#PolyXGOModalMessageContent').html('Serial của bạn hiện tại đã hết hạn hoặc bạn chưa đăng ký sử dụng dịch vụ với chúng tôi. Bạn vui lòng đăng ký một số serial mới để tiếp tục sử dụng plugin này.')}else{modalXXX.find('#PolyXGOModalMessageTitle').html('Error! ('+data.status+')');modalXXX.find('#PolyXGOModalMessageContent').html('Có lỗi xảy ra trong quá trình đồng bộ dữ liệu, vui lòng kiểm tra và thử lại!.<br/><b>Lưu ý:</b> Trong trường hợp bạn không thể khắc phục sự cố, vui lòng gửi thông báo lỗi: ('+data.status+') '+data.message+' cho chúng tôi để được hỗ trợ.')}
modalXXX.modal("show")}else{$coupons=$coupons.concat(data);$scope.coupons=$coupons;$scope.messrest=''}}else{$scope.isdone=!0;$scope.messrest='[hoàn tất], '}},function errorCallback(response){var data=response.data;if(data.message==='Unauthorized'||data.status==='401'){modalXXX.find('#PolyXGOModalMessageTitle').html('Serial hết hạn! ('+data.status+')');modalXXX.find('#PolyXGOModalMessageContent').html('Serial của bạn hiện tại đã hết hạn hoặc bạn chưa đăng ký sử dụng dịch vụ với chúng tôi. Bạn vui lòng đăng ký một số serial mới để tiếp tục sử dụng plugin này.')}else{modalXXX.find('#PolyXGOModalMessageTitle').html('Error! ('+data.status+')');modalXXX.find('#PolyXGOModalMessageContent').html('Có lỗi xảy ra trong quá trình đồng bộ dữ liệu, vui lòng kiểm tra và thử lại!.<br/><b>Lưu ý:</b> Trong trường hợp bạn không thể khắc phục sự cố, vui lòng gửi thông báo lỗi: ('+data.status+') '+data.message+' cho chúng tôi để được hỗ trợ.')}
modalXXX.modal("show")})}}
$scope.PolyXGOSuppliersFilter=function(obj){$scope.search=obj}
$scope.PolyXGOCouponsDataRest();$scope.SelectedSupplier=function(obj){$scope.search=obj}
$scope.PolyXGOAddCoupons=function(obj,isList,isAll){var platform=jQuery('#platformTracking_'+obj.id).val();if(isAll==!0){platform=jQuery('#platformTracking').val()}
var data={action:'PolyXGOAddCoupons',objData:obj,Platform:platform,timeout:20000,};jQuery.post(spyr_params.ajaxurl,data,function(data){if(isList===!0){if(isAll==!0){$scope.SyncingMessage=($scope.SyncingCounter+"/"+$scope.couponsFiltered.length)}else{$scope.SyncingMessage=($scope.SyncingCounter+"/"+$scope.selected.length)}}else{var rest=jQuery(data).find('message').text();$scope.Alert(obj.title,rest)}});if(isList!=!0){e.preventDefault()}}
$scope.selected=[];var updateSelected=function(action,id){if(action==='add'&&$scope.selected.indexOf(id)===-1){$scope.selected.push(id)}
if(action==='remove'&&$scope.selected.indexOf(id)!==-1){$scope.selected.splice($scope.selected.indexOf(id),1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target;var action=(checkbox.checked?'add':'remove');updateSelected(action,id)};$scope.selectAll=function($event){var checkbox=$event.target;var action=(checkbox.checked?'add':'remove');for(var i=0;i<$scope.couponsFiltered.length;i++){var coupon=$scope.couponsFiltered[i];updateSelected(action,coupon.id)}};$scope.getSelectedClass=function(coupon){return $scope.isSelected(coupon.id)?'selected':''};$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};$scope.isSelectedAll=function(){return $scope.selected.length===$scope.selected.length};$scope.PolyXGOCouponsSyncSelected=function(){$scope.SyncingCounter=0;$scope.SyncingMessage='';if($scope.selected.length==0){$scope.Alert('Thông báo','Vui lòng chọn danh sách mã giảm giá, tin khuyến mãi trước.');return}
var c=0;$scope.Alert('Đang xử lý dữ liệu!','Đã xử lý đồng bộ <strong class="coupons_syncing">'+$scope.SyncingCounter+'/'+$scope.selected.length+'</strong> dữ liệu đã chọn, bạn vui lòng đợi cho đến khi hoàn tất!');var ProcessingData=function(){var xx=CouponInformation($scope.selected[c]);if(xx!=null){$scope.PolyXGOAddCoupons(xx,!0)}
c++;if(c<=$scope.selected.length){$scope.SyncingCounter++;$scope.Alert('Đang xử lý dữ liệu!','Đã xử lý đồng bộ <strong class="coupons_syncing">'+$scope.SyncingCounter+'/'+$scope.selected.length+'</strong> dữ liệu đã chọn, bạn vui lòng đợi cho đến khi hoàn tất!');$timeout(ProcessingData,1000)}}
$timeout(ProcessingData,500)}
$scope.PolyXGOCouponsSyncAll=function(){$scope.SyncingCounter=0;$scope.SyncingMessage='';if($scope.couponsFiltered.length==0)return;var c=0;$scope.Alert('Đang xử lý dữ liệu!','Đã xử lý đồng bộ <strong class="coupons_syncing">'+$scope.SyncingCounter+'/'+$scope.couponsFiltered.length+'</strong> dữ liệu đã lấy về, bạn vui lòng đợi cho đến khi hoàn tất!');var ProcessingData=function(){var xx=$scope.couponsFiltered[c];if(xx!=null){$scope.PolyXGOAddCoupons(xx,!0,!0)}
c++;if(c<=$scope.couponsFiltered.length){$scope.SyncingCounter++;$scope.Alert('Đang xử lý dữ liệu!','Đã xử lý đồng bộ <strong class="coupons_syncing">'+$scope.SyncingCounter+'/'+$scope.couponsFiltered.length+'</strong> dữ liệu đã lấy về, bạn vui lòng đợi cho đến khi hoàn tất!');$timeout(ProcessingData,1000)}}
$timeout(ProcessingData,500)}
$scope.SelectedTypeData=function(objVal){$scope.search.typeData=objVal}
CouponInformation=function($couponID){for(var i=0;i<$scope.couponsFiltered.length;i++){if($scope.couponsFiltered[i].ID===$couponID){return $scope.couponsFiltered[i]}}
return null}
$scope.Alert=function(title,message){modalXXX.find('#PolyXGOModalMessageTitle').html(title);modalXXX.find('#PolyXGOModalMessageContent').html(message);if(!modalXXX.hasClass('in')){modalXXX.modal('show')}}});polyxgoApp.filter('unique',function(){return function(items,filterOn){if(filterOn===!1){return items}
if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var hashCheck={},newItems=[];var extractValueToCompare=function(item){if(angular.isObject(item)&&angular.isString(filterOn)){return item[filterOn]}else{return item}};angular.forEach(items,function(item){var valueToCheck,isDuplicate=!1;for(var i=0;i<newItems.length;i++){if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=!0;break}}
if(!isDuplicate){newItems.push(item)}});items=newItems}
return items}})